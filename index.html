<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<meta name="description" content="Fair Discovery: The decentralized, AI-ranked directory of authentic businesses." />
<meta name="theme-color" content="#1a73e8" />
<title>Fair Discovery Directory</title>

<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%231a73e8'/%3E%3Ccircle cx='42' cy='42' r='24' stroke='white' stroke-width='12' fill='none'/%3E%3Cline x1='60' y1='60' x2='85' y2='85' stroke='white' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">

<style>
  /* ---------- THEME ---------- */
  :root {
    --bg: #0f1723; 
    --card-bg: #08101a;
    --text: #e6eef7;
    --sub: #9fb0c8;
    --border: rgba(255,255,255,0.08);
    --accent: #1a73e8;
    --glass: rgba(255,255,255,0.05);
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  [data-theme="light"] {
    --bg: #f6f8fb; 
    --card-bg: #ffffff; 
    --text: #0b1220; 
    --sub: #4b5563; 
    --border: #e6e9ef; 
    --glass: rgba(16,24,40,0.02);
  }

  body { margin: 0; background: var(--bg); color: var(--text); transition: 0.3s; display: flex; flex-direction: column; min-height: 100vh; }
  * { box-sizing: border-box; }
  a { text-decoration: none; color: inherit; }

  /* CONTAINER */
  .app-wrap { max-width: 1200px; margin: 0 auto; padding: 0 20px; width: 100%; }

  /* HEADER */
  header { padding: 20px 0; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 50; background: var(--bg); }
  
  .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .brand { display: flex; align-items: center; gap: 10px; font-size: 1.4rem; font-weight: bold; }
  .brand svg { width: 32px; height: 32px; }
  
  .controls { display: flex; gap: 8px; }
  .btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: var(--glass); color: var(--text); cursor: pointer; font-size: 0.85rem; }
  .btn:hover { border-color: var(--accent); color: var(--accent); }

  /* FILTERS */
  .filters { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
  input, select { padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--glass); color: var(--text); font-size: 1rem; outline: none; }
  input { flex: 1; min-width: 200px; }
  select { cursor: pointer; }
  
  .cats { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; -webkit-overflow-scrolling: touch; }
  .pill { white-space: nowrap; padding: 6px 14px; border-radius: 20px; background: var(--glass); border: 1px solid var(--border); cursor: pointer; color: var(--sub); transition: 0.2s; font-size: 0.9rem; }
  .pill.active { background: var(--accent); color: white; border-color: var(--accent); }

  /* GRID */
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding-bottom: 40px; }
  
  .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: 0.2s; cursor: pointer; display: flex; flex-direction: column; }
  .card:hover { transform: translateY(-4px); border-color: var(--accent); }
  
  .banner { height: 100px; background-size: cover; background-position: center; }
  .card-body { padding: 15px; display: flex; flex-direction: column; gap: 5px; flex: 1; }
  
  .logo { width: 48px; height: 48px; border-radius: 8px; background: var(--card-bg); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-top: -40px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
  
  .title { font-size: 1.1rem; font-weight: bold; margin: 5px 0 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .meta { font-size: 0.85rem; color: var(--sub); }
  .desc { font-size: 0.9rem; color: var(--text); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.8em; margin-bottom: 10px; }
  
  .foot { margin-top: auto; padding-top: 10px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--sub); }

  /* FOOTER */
  footer { text-align: center; padding: 40px 0; margin-top: auto; border-top: 1px solid var(--border); color: var(--sub); font-size: 0.9rem; }
  .coffee-btn { background: #FFDD00; color: black; padding: 10px 20px; border-radius: 50px; text-decoration: none; font-weight: bold; display: inline-block; margin: 15px 0; }

  /* MODAL */
  .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
  .modal { background: var(--card-bg); width: 100%; max-width: 500px; border-radius: 16px; overflow: hidden; max-height: 90vh; display: flex; flex-direction: column; position: relative; }
  .modal-close { position: absolute; top: 15px; right: 15px; width: 32px; height: 32px; background: rgba(0,0,0,0.5); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; font-weight: bold; }
  .modal-scroll { overflow-y: auto; padding: 20px; }
  
  .info-row { display: flex; gap: 10px; margin: 15px 0; }
  .info-box { flex: 1; background: var(--bg); padding: 10px; border-radius: 8px; border: 1px solid var(--border); font-size: 0.9rem; }
  .visit-btn { display: block; background: var(--accent); color: white; text-align: center; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 10px; }
  
  .stars { display: flex; justify-content: center; gap: 8px; margin-top: 20px; font-size: 1.5rem; cursor: pointer; }
  .stars span:hover { color: gold; }
</style>
</head>
<body>

<div class="app-wrap">
  <header>
    <div class="top-row">
      <div class="brand">
        <svg viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="#1a73e8"/><circle cx="42" cy="42" r="24" stroke="white" stroke-width="12" fill="none"/><line x1="60" y1="60" x2="85" y2="85" stroke="white" stroke-width="12" stroke-linecap="round"/></svg>
        Fair Discovery
      </div>
      <div class="controls">
        <button class="btn" onclick="openJoin()">ğŸš€ Join</button>
        <select class="btn" onchange="alert('Languages in V2')">
          <option>ğŸ‡ºğŸ‡¸ EN</option><option>ğŸ‡ªğŸ‡¸ ES</option><option>ğŸ‡«ğŸ‡· FR</option><option>ğŸ‡©ğŸ‡ª DE</option><option>ğŸ‡§ğŸ‡· PT</option>
        </select>
        <button class="btn" onclick="toggleTheme()">ğŸŒ™</button>
      </div>
    </div>

    <div class="filters">
      <input type="text" id="search" placeholder="Search...">
      <select id="locFilter" onchange="filter()">
        <option value="all">ğŸŒ Global</option>
      </select>
    </div>

    <div class="cats">
      <div class="pill active" onclick="setCat('all', this)">All</div>
      <div class="pill" onclick="setCat('Auto', this)">ğŸš— Auto</div>
      <div class="pill" onclick="setCat('Tech', this)">ğŸ’» Tech</div>
      <div class="pill" onclick="setCat('Health', this)">ğŸ¥ Health</div>
      <div class="pill" onclick="setCat('Service', this)">ğŸ› ï¸ Services</div>
      <div class="pill" onclick="setCat('Retail', this)">ğŸ›ï¸ Retail</div>
      <div class="pill" onclick="setCat('Artists', this)">ğŸ¨ Artists</div>
      <div class="pill" onclick="setCat('Real Estate', this)">ğŸ  Property</div>
      <div class="pill" onclick="setCat('Travel', this)">âœˆï¸ Holiday</div>
    </div>
  </header>

  <div style="padding: 20px 0; display:flex; justify-content:space-between; color:var(--sub); font-size:0.9rem;">
    <span id="count">Loading...</span>
    <span>Network Live</span>
  </div>

  <div id="grid" class="grid"></div>

  <footer>
    <p>Fair Discovery 2025 â€¢ Open Source Directory</p>
    <a href="https://www.buymeacoffee.com/Prinymity" target="_blank" class="coffee-btn">â˜• Buy me a coffee</a>
    <p style="margin-top:15px">Powered by Gemini â€¢ GitHub â€¢ The Fair Collective â€¢ <a href="data.json" target="_blank" style="color:var(--accent)">API</a></p>
  </footer>
</div>

<div id="modal" class="modal-bg" onclick="closeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div id="mBanner" class="banner" style="height:140px;">
      <div class="modal-close" onclick="closeModal()">âœ•</div>
    </div>
    <div class="modal-scroll">
      <div class="logo" id="mLogo" style="margin-top:-40px; position:relative; z-index:2;">ğŸŒ</div>
      <h2 id="mTitle" style="margin:10px 0 5px;">Business</h2>
      <div id="mMeta" style="color:var(--sub); font-size:0.9rem;">Category â€¢ Location</div>
      <p id="mDesc" style="line-height:1.6;">Description...</p>
      
      <div class="info-row">
        <div class="info-box"><strong>ğŸ“ Location</strong><br><span id="mLoc">City</span></div>
        <div class="info-box"><strong>ğŸ“ Contact</strong><br><span id="mPhone">Num</span></div>
      </div>
      
      <a id="mLink" href="#" target="_blank" class="visit-btn">Visit Website â†—</a>
      
      <div style="text-align:center; margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">
        <small style="text-transform:uppercase; font-weight:bold; color:var(--sub);">Rate this Business</small>
        <div class="stars">
          <span onclick="rate(1)">â˜…</span><span onclick="rate(2)">â˜…</span><span onclick="rate(3)">â˜…</span><span onclick="rate(4)">â˜…</span><span onclick="rate(5)">â˜…</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="joinModal" class="modal-bg" onclick="closeJoin()">
  <div class="modal" onclick="event.stopPropagation()" style="padding:30px; text-align:center; height:auto;">
    <div class="modal-close" onclick="closeJoin()" style="top:10px; right:10px; background:transparent; color:var(--text);">âœ•</div>
    <h2>ğŸš€ How to Join</h2>
    <p style="color:var(--sub); margin-bottom:20px;">1. Download kit from GitHub.<br>2. Upload to your site.<br>3. Submit URL below.</p>
    <a href="https://github.com/fair-collective/fair-discovery/issues/new?title=Add%20Site" target="_blank" class="visit-btn">Submit Site</a>
  </div>
</div>

<script>
// THEME MEMORY
if(localStorage.getItem('theme') === 'light') document.documentElement.setAttribute('data-theme', 'light');

const FEED = 'data.json';
let allData = [], filtered = [], curCat = 'all';
let currentBiz = "";

const images = {
    'Auto': 'https://images.unsplash.com/photo-1486262715619-01b8c22973f5?w=600&q=80',
    'Tech': 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=600&q=80',
    'Health': 'https://images.unsplash.com/photo-1505751172876-fa1923c5c528?w=600&q=80',
    'Service': 'https://images.unsplash.com/photo-1581578077058-612788a8966c?w=600&q=80',
    'Retail': 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=600&q=80',
    'Artists': 'https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?w=600&q=80',
    'Real Estate': 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=600&q=80',
    'Travel': 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=600&q=80'
};

async function init(){
  try {
    const res = await fetch(FEED + '?' + Date.now());
    const json = await res.json();
    const map = {};
    (json.pages || []).forEach(p => {
        try {
            let d = new URL(p.url.startsWith('http')?p.url:'https://'+p.url).hostname;
            if(!map[d]) map[d] = {
                domain: d, url: p.url, score: p.score || 0,
                cat: p.category || "Service",
                desc: p.description || "Verified Listing",
                wa: p.whatsapp, loc: p.location, deal: p.deal
            };
            map[d].score += p.score;
        } catch(e){}
    });
    allData = Object.values(map).sort((a,b) => b.score - a.score);
    
    // Locations
    const locs = new Set();
    allData.forEach(i => {
        if(i.loc) {
            locs.add(i.loc);
            if(i.loc.includes(',')) locs.add(i.loc.split(',')[1].trim());
        }
    });
    const sel = document.getElementById('locFilter');
    [...locs].sort().forEach(l => sel.innerHTML += `<option value="${l}">${l}</option>`);

    filter();
  } catch(e) { document.getElementById('grid').innerHTML = '<p style="text-align:center">Loading...</p>'; }
}

function filter() {
    const term = document.getElementById('search').value.toLowerCase();
    const loc = document.getElementById('locFilter').value;
    
    filtered = allData.filter(i => {
        const matchCat = curCat === 'all' || i.cat === curCat;
        let matchLoc = loc === 'all';
        if (!matchLoc && i.loc) matchLoc = i.loc.includes(loc);
        const text = (i.domain + i.desc + i.cat).toLowerCase();
        return matchCat && matchLoc && text.includes(term);
    });
    render();
}

function render() {
    const grid = document.getElementById('grid'); grid.innerHTML = '';
    document.getElementById('count').innerText = `Found ${filtered.length}`;
    
    filtered.forEach((item, idx) => {
        let flag = item.domain.endsWith('.za') ? 'ğŸ‡¿ğŸ‡¦' : 'ğŸŒ';
        let img = images[item.cat] || images['Service'];
        let title = formatTitle(item.domain);
        let deal = item.deal ? `<div style="color:#e11d48; font-weight:bold; font-size:0.7rem; margin-top:5px;">ğŸ”¥ ${item.deal}</div>` : '';

        const card = document.createElement('div');
        card.className = 'card';
        card.onclick = () => openModal(idx);
        card.innerHTML = `
            <div class="banner" style="background-image:url('${img}')"></div>
            <div class="card-body">
                <div class="logo">${flag}</div>
                <div style="position:absolute; top:10px; right:10px; font-size:0.7rem; font-weight:bold; color:#22c55e; background:rgba(34,197,94,0.1); padding:4px 8px; border-radius:4px;">âœ“ VERIFIED</div>
                <div class="title">${title}</div>
                <div class="meta">${item.domain.replace('.local','')}</div>
                <div class="desc">${item.desc}</div>
                ${deal}
                <div class="foot">
                    <span>${item.cat}</span>
                    <span style="font-weight:bold; color:var(--accent);">${formatScore(item.score)} AUTH</span>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
}

function openModal(idx) {
    const i = filtered[idx];
    currentBiz = formatTitle(i.domain);
    let img = images[i.cat] || images['Service'];
    
    document.getElementById('mBanner').style.backgroundImage = `url('${img}')`;
    document.getElementById('mTitle').innerText = currentBiz;
    document.getElementById('mMeta').innerText = `${i.cat} â€¢ ${i.loc || 'Global'}`;
    document.getElementById('mDesc').innerText = i.desc;
    document.getElementById('mLoc').innerText = i.loc || 'Global';
    document.getElementById('mPhone').innerText = i.wa ? '+' + i.wa : 'N/A';
    
    let link = i.url;
    if(i.domain.includes('.local') && i.wa) link = `https://wa.me/${i.wa}`;
    document.getElementById('mLink').href = link;
    
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }
function openJoin() { document.getElementById('joinModal').style.display = 'flex'; }
function closeJoin() { document.getElementById('joinModal').style.display = 'none'; }

function toggleTheme() {
    const root = document.documentElement;
    const theme = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    root.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
}

function formatTitle(d) {
    if(d.includes("greyzone")) return "Grey Zone Auto Parts";
    if(d.includes("aolocksmith")) return "AO Locksmith";
    if(d.includes("autods")) return "Auto Digital Solutions";
    if(d.includes("bookkeepers")) return "Bookkeepers SA";
    if(d.includes("seritipbo")) return "Seriti PBO";
    if(d.includes("scouts")) return "Save Our Children";
    if(d.includes("jotto")) return "Jotto's Portfolio";
    if(d.includes("skyrope")) return "Sky Rope Specialist";
    if(d.includes("intpanel")) return "International Panel Shop";
    if(d.includes("ccg")) return "CCG Auto Glass";
    return d.split('.')[0].charAt(0).toUpperCase() + d.split('.')[0].slice(1);
}

function formatScore(n) { return n > 1000 ? (n/1000).toFixed(1)+'k' : n; }
function setCat(c, el) { curCat = c; document.querySelectorAll('.pill').forEach(e=>e.classList.remove('active')); el.classList.add('active'); filter(); }
function rate(s) {
    const formId = "1FAIpQLSefrTrv68_G_l-6-6J41szCGqg_DcTxklCcWAPJ6e-_oV0k8A";
    window.open(`https://docs.google.com/forms/d/e/${formId}/viewform?usp=pp_url&entry.1871531298=${encodeURIComponent(currentBiz)}&entry.741708013=${s}`, '_blank');
}

document.getElementById('search').addEventListener('input', filter);
init();
</script>
</body>
</html>
