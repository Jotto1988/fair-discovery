<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Fair Discovery: The decentralized, AI-ranked directory of authentic businesses.">
    <meta name="theme-color" content="#1a73e8">
    <title>Fair Discovery</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%231a73e8'/%3E%3Ccircle cx='42' cy='42' r='24' stroke='white' stroke-width='12' fill='none'/%3E%3Cline x1='60' y1='60' x2='85' y2='85' stroke='white' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">

    <style>
        /* --- VARIABLES --- */
        :root {
            --bg: #f8f9fa; --card-bg: #ffffff; --text: #202124; --text-sub: #5f6368; 
            --border: #dadce0; --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --accent: #1a73e8; --success: #188038;
        }
        [data-theme="dark"] {
            --bg: #202124; --card-bg: #303134; --text: #e8eaed; --text-sub: #9aa0a6;
            --border: #3c4043; --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --accent: #8ab4f8; --success: #81c995;
        }

        body { font-family: 'Google Sans', 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; transition: background 0.3s; }

        /* HEADER */
        header {
            background: var(--card-bg); padding: 20px; text-align: center;
            border-bottom: 1px solid var(--border); position: relative;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        h1 { 
            font-size: 1.8rem; margin: 0; letter-spacing: -0.5px; 
            display: flex; align-items: center; gap: 10px; color: var(--text);
        }
        
        .controls { display: flex; gap: 10px; }
        .icon-btn { 
            background: transparent; border: 1px solid var(--border); color: var(--text);
            width: 36px; height: 36px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn:hover { background: var(--bg); border-color: var(--accent); }

        /* SEARCH & FILTERS */
        .filter-bar {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; max-width: 800px; margin: 0 auto;
        }
        
        .search-wrapper {
            flex: 1; min-width: 250px; position: relative; display: flex; align-items: center;
        }
        
        .search-box {
            width: 100%; padding: 12px 45px 12px 20px; border-radius: 24px; 
            border: 1px solid var(--border); background: var(--bg); color: var(--text);
            font-size: 1rem; outline: none; transition: 0.2s;
        }
        .search-box:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(26,115,232,0.1); background: var(--card-bg); }

        /* GEO BUTTON INSIDE SEARCH */
        .geo-btn {
            position: absolute; right: 10px; background: none; border: none; cursor: pointer;
            font-size: 1.2rem; color: var(--text-sub); transition: 0.2s;
            padding: 5px; border-radius: 50%;
        }
        .geo-btn:hover { color: var(--accent); background: rgba(26,115,232,0.1); }
        .geo-btn.loading { animation: spin 1s linear infinite; cursor: wait; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .loc-select {
            padding: 12px 30px 12px 20px; border-radius: 24px; border: 1px solid var(--border);
            background: var(--bg) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="%23555"><path d="M2 4l4 4 4-4"/></svg>') no-repeat right 12px center;
            color: var(--text); font-size: 0.9rem; cursor: pointer; appearance: none; min-width: 140px;
        }

        .category-scroll { 
            display: flex; gap: 8px; overflow-x: auto; padding: 15px 0 5px; 
            justify-content: center; scrollbar-width: none; mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        }
        .cat-pill {
            padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 500;
            background: var(--bg); border: 1px solid var(--border); cursor: pointer;
            color: var(--text-sub); transition: 0.2s; white-space: nowrap;
        }
        .cat-pill:hover, .cat-pill.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* CARD GRID */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .stats-bar { display: flex; justify-content: space-between; color: var(--text-sub); font-size: 0.85rem; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }

        /* CARD */
        .card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            border: 1px solid var(--border); box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.1); border-color: var(--accent); }

        .card-header { padding: 16px; display: flex; gap: 15px; align-items: flex-start; }
        .card-logo { 
            width: 48px; height: 48px; border-radius: 8px; background: var(--bg); 
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; 
            border: 1px solid var(--border); flex-shrink: 0;
        }
        
        .card-body { flex: 1; min-width: 0; }
        .card-title { font-size: 1.1rem; font-weight: 600; margin: 0 0 4px; color: var(--text); line-height: 1.3; word-wrap: break-word; }
        .card-meta { font-size: 0.8rem; color: var(--text-sub); display: flex; align-items: center; gap: 6px; flex-wrap: wrap;}
        .verified-badge { color: var(--success); background: rgba(24,128,56,0.1); padding: 2px 6px; border-radius: 4px; font-weight: 500; font-size: 0.7rem; }

        .card-desc { padding: 0 16px; font-size: 0.9rem; color: var(--text-sub); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 15px; }
        
        .deal-badge { 
            background: linear-gradient(135deg, #FF512F, #DD2476); color: white; 
            font-size: 0.7rem; padding: 4px 10px; border-radius: 20px; font-weight: 700;
            display: inline-block; margin: 0 16px 15px; align-self: flex-start; box-shadow: 0 2px 5px rgba(255, 81, 47, 0.3);
        }

        .card-footer { 
            margin-top: auto; padding: 12px 16px; border-top: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; background: var(--bg);
        }
        .score-val { font-weight: 700; color: var(--accent); }
        .score-lbl { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; margin-left: 5px;}

        /* BANNER IMAGES */
        .bg-auto { background-image: url('https://images.unsplash.com/photo-1486262715619-01b8c22973f5?auto=format&fit=crop&w=800&q=80'); }
        .bg-tech { background-image: url('https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=800&q=80'); }
        .bg-health { background-image: url('https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=800&q=80'); }
        .bg-service { background-image: url('https://images.unsplash.com/photo-1581578077058-612788a8966c?auto=format&fit=crop&w=800&q=80'); }
        .bg-retail { background-image: url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=800&q=80'); }
        .bg-art { background-image: url('https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?auto=format&fit=crop&w=800&q=80'); }

        /* MODAL */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-card { background: var(--card-bg); width: 90%; max-width: 550px; border-radius: 16px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); position: relative; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }

        .modal-banner { height: 150px; background-size: cover; background-position: center; position: relative; display: flex; align-items: flex-end; padding: 20px; }
        .modal-banner::after { content:''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
        .modal-quote { position: relative; z-index: 2; color: white; font-style: italic; font-size: 0.95rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(4px); z-index: 10; }

        .modal-body { padding: 25px; }
        .modal-title { font-size: 1.8rem; margin: 0 0 5px; color: var(--text); line-height: 1.2; }
        .modal-meta { color: var(--text-sub); font-size: 0.9rem; margin-bottom: 20px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .info-box { background: var(--bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border); }
        .info-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-sub); font-weight: 700; display: block; margin-bottom: 4px; }
        
        .btn-primary { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: 600; cursor: pointer; display: block; text-align: center; text-decoration: none; }
        .btn-primary:hover { filter: brightness(1.1); box-shadow: 0 4px 12px rgba(26,115,232,0.3); }

        .rating-stars { display: flex; gap: 8px; justify-content: center; margin-top: 10px; }
        .star { font-size: 1.6rem; color: #ddd; cursor: pointer; transition: 0.2s; background: none; border: none; }
        .star:hover { color: #fbbc04; transform: scale(1.2); }

        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; }
            .categories { justify-content: flex-start; }
            .modal-card { width: 100%; height: 100%; border-radius: 0; max-width: none; margin: 0; }
            .modal-close { top: 20px; right: 20px; background: rgba(0,0,0,0.5); }
        }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="controls">
            <button class="icon-btn" onclick="openJoin()" title="Join Network">üöÄ</button>
            <button id="installBtn" class="icon-btn" onclick="installPWA()" style="display:none" title="Install App">üì≤</button>
        </div>
        <h1>
            <svg width="32" height="32" viewBox="0 0 100 100" fill="none">
                <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#1a73e8"/><stop offset="1" stop-color="#8ab4f8"/></linearGradient></defs>
                <path d="M50 5 L90 20 V50 C90 75 50 95 50 95 C50 95 10 75 10 50 V20 Z" fill="url(#g)"/>
                <circle cx="50" cy="45" r="16" stroke="white" stroke-width="6" fill="none"/>
                <line x1="60" y1="55" x2="72" y2="67" stroke="white" stroke-width="6" stroke-linecap="round"/>
            </svg>
            Fair Discovery
        </h1>
        <div class="controls">
            <button class="icon-btn" onclick="toggleTheme()" title="Theme">üåô</button>
        </div>
    </div>

    <div class="filter-bar">
        <div class="search-wrapper">
            <input type="text" class="search-box" id="searchInput" placeholder="Search businesses, services...">
            <button class="geo-btn" onclick="geoFindMe()" title="Find Near Me">üìç</button>
        </div>
        
        <select id="locFilter" class="loc-select" onchange="filter()">
            <option value="all">üåç Global</option>
        </select>
    </div>

    <div class="category-scroll">
        <div class="cat-pill active" onclick="setCat('all')">All</div>
        <div class="cat-pill" onclick="setCat('Auto')">üöó Auto</div>
        <div class="cat-pill" onclick="setCat('Tech')">üíª Tech</div>
        <div class="cat-pill" onclick="setCat('Health')">üè• Health</div>
        <div class="cat-pill" onclick="setCat('Service')">üõ†Ô∏è Services</div>
        <div class="cat-pill" onclick="setCat('Retail')">üõçÔ∏è Retail</div>
        <div class="cat-pill" onclick="setCat('Artists')">üé® Artists</div>
        <div class="cat-pill" onclick="setCat('Real Estate')">üè† Property</div>
        <div class="cat-pill" onclick="setCat('Travel')">‚úàÔ∏è Holiday</div>
    </div>
</header>

<div class="container">
    <div class="stats-bar">
        <span id="countLabel">Loading...</span>
        <span>Network Live</span>
    </div>
    <div id="grid" class="grid"></div>
</div>

<footer style="text-align:center; padding:40px; color:var(--text-sub); border-top:1px solid var(--border); font-size:0.9rem; margin-top:40px;">
    <p>Fair Discovery &copy; 2025 ‚Ä¢ Decentralized & Open Source</p>
    <div style="margin: 20px 0;">
        <a href="https://www.buymeacoffee.com/Prinymity" target="_blank" style="background:#FFDD00; color:black; padding:8px 16px; border-radius:20px; font-weight:bold; text-decoration:none;">‚òï Support the Dev</a>
    </div>
    <p style="opacity:0.6;">Powered by Gemini ‚Ä¢ GitHub ‚Ä¢ The Fair Collective</p>
</footer>

<div id="modal" class="modal-backdrop" onclick="closeModal()">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div id="modalBanner" class="modal-banner bg-service">
            <div class="modal-close" onclick="closeModal()">‚úï</div>
            <div class="modal-quote" id="modalQuote">"Trust is the currency of the future."</div>
        </div>
        <div class="modal-body">
            <h2 class="modal-title" id="mTitle">Business Name</h2>
            <div class="modal-meta" id="mMeta">Category ‚Ä¢ Location</div>
            
            <p id="mDesc" style="color:var(--text); line-height:1.6; margin-bottom:25px;">Description goes here.</p>

            <div class="info-grid">
                <div class="info-box">
                    <span class="info-label">üìç Location</span>
                    <div id="mLoc">City</div>
                </div>
                <div class="info-box">
                    <span class="info-label">üìû Contact</span>
                    <div id="mPhone">Number</div>
                </div>
            </div>

            <a id="mLink" href="#" target="_blank" class="btn-primary">Visit Website ‚Üó</a>

            <div style="margin-top:20px; text-align:center; border-top:1px solid var(--border); padding-top:15px;">
                <span class="info-label">Rate this Business</span>
                <div class="rating-stars">
                    <button class="star" onclick="rate(1)">‚òÖ</button>
                    <button class="star" onclick="rate(2)">‚òÖ</button>
                    <button class="star" onclick="rate(3)">‚òÖ</button>
                    <button class="star" onclick="rate(4)">‚òÖ</button>
                    <button class="star" onclick="rate(5)">‚òÖ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const FEED = 'data.json';
    let allData = [], filtered = [];
    let curCat = 'all';
    let currentBiz = "";
    
    const quotes = [
        "\"Quality means doing it right when no one is looking.\"",
        "\"Truth is the only safe ground to stand upon.\"",
        "\"Honesty is the first chapter in the book of wisdom.\"",
        "\"Fairness is a professional skill.\""
    ];

    // --- PWA ---
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e;
        document.getElementById('installBtn').style.display = 'flex';
    });
    function installPWA() { if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; } }
    if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');

    // --- INIT ---
    async function init() {
        try {
            const res = await fetch(FEED + '?' + Date.now());
            const json = await res.json();
            
            const map = {};
            (json.pages || []).forEach(p => {
                try {
                    let d = new URL(p.url.startsWith('http')?p.url:'https://'+p.url).hostname;
                    if(!map[d]) map[d] = {
                        domain: d, url: p.url, score: 0,
                        cat: p.category || inferCat(d),
                        desc: p.description || "Verified listing.",
                        wa: p.whatsapp, loc: p.location || "Global",
                        deal: p.deal
                    };
                    map[d].score += p.score;
                    if(p.category) map[d].cat = p.category;
                    if(p.description) map[d].desc = p.description;
                } catch(e){}
            });
            allData = Object.values(map).sort((a,b) => b.score - a.score);
            
            // Smart Location Grouping
            const locs = new Set();
            allData.forEach(i => {
                if(i.loc) {
                    locs.add(i.loc); // Add exact (Cape Town, SA)
                    // Add Country (SA) if comma exists
                    if(i.loc.includes(',')) locs.add(i.loc.split(',')[1].trim());
                }
            });
            const sortedLocs = [...locs].sort();
            const sel = document.getElementById('locFilter');
            sortedLocs.forEach(l => {
                if(l && l !== "Global") sel.innerHTML += `<option value="${l}">${l}</option>`;
            });

            filter();
        } catch(e) { document.getElementById('grid').innerHTML = '<p style="text-align:center">Loading...</p>'; }
    }

    function inferCat(d) {
        d = d.toLowerCase();
        if(d.includes('auto')||d.includes('panel')||d.includes('motor')) return 'Auto';
        if(d.includes('tech')||d.includes('app')) return 'Tech';
        if(d.includes('health')) return 'Health';
        if(d.includes('property')||d.includes('estate')) return 'Real Estate';
        if(d.includes('travel')||d.includes('bnb')) return 'Travel';
        return 'Service';
    }

    function formatTitle(d) {
        if(d.includes("greyzone")) return "Grey Zone Auto Parts";
        if(d.includes("aolocksmith")) return "AO Locksmith";
        if(d.includes("autods")) return "Auto Digital Solutions";
        if(d.includes("bookkeepers")) return "Bookkeepers SA";
        if(d.includes("seriti")) return "Seriti PBO";
        if(d.includes("scouts")) return "Save Our Children";
        if(d.includes("jotto")) return "Jotto's Portfolio";
        if(d.includes("skyrope")) return "Sky Rope Specialist";
        if(d.includes("intpanel")) return "International Panel Shop";
        return d.split('.')[0].charAt(0).toUpperCase() + d.split('.')[0].slice(1);
    }

    // --- GEO LOCATION ---
    function geoFindMe() {
        const btn = document.querySelector('.geo-btn');
        if(!navigator.geolocation) return alert('Geolocation not supported');
        
        btn.classList.add('loading');
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const { latitude, longitude } = pos.coords;
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                const data = await res.json();
                const city = data.address.city || data.address.town || data.address.village || "";
                document.getElementById('searchInput').value = city;
                filter();
            } catch(e) { alert('Could not locate you.'); }
            btn.classList.remove('loading');
        }, () => { btn.classList.remove('loading'); alert('Location access denied.'); });
    }

    // --- FILTERING ---
    function setCat(c) {
        curCat = c;
        document.querySelectorAll('.cat-pill').forEach(e => e.classList.remove('active'));
        event.target.classList.add('active');
        filter();
    }

    function filter() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const loc = document.getElementById('locFilter').value;
        
        filtered = allData.filter(i => {
            const matchCat = curCat === 'all' || i.cat === curCat;
            
            // Smart Loc Logic (Matches "SA" for "Cape Town, SA")
            let matchLoc = loc === 'all';
            if (!matchLoc && i.loc) matchLoc = i.loc.includes(loc);
            
            const text = (i.domain + i.desc + i.cat + i.loc + formatTitle(i.domain)).toLowerCase();
            const matchTerm = text.includes(term);
            return matchCat && matchLoc && matchTerm;
        });
        
        render();
    }

    function render() {
        const grid = document.getElementById('grid'); grid.innerHTML = '';
        document.getElementById('countLabel').innerText = `Found ${filtered.length} sites`;
        
        filtered.forEach((item, idx) => {
            let flag = item.domain.endsWith('.za') ? 'üáøüá¶' : 'üåê';
            let bannerClass = `bg-${item.cat.toLowerCase().replace(' ', '-')}` || 'bg-service';
            let dealBadge = item.deal ? `<div class="deal-badge">üî• ${item.deal}</div>` : '';
            
            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openModal(idx);
            card.innerHTML = `
                <div class="card-banner ${bannerClass}" style="background-size:cover; background-position:center;"></div>
                <div class="card-content">
                    <div class="card-brand">
                        <div class="card-logo">${flag}</div>
                        <span class="verified-tag">‚úì Verified</span>
                    </div>
                    <h3 class="card-title">${formatTitle(item.domain)}</h3>
                    <span style="font-size:0.8rem; color:#999">${item.domain.replace('.local','')}</span>
                    ${dealBadge}
                    <p class="card-desc">${item.desc}</p>
                    <div class="card-footer">
                        <span style="font-size:0.8rem; font-weight:500;">${item.cat}</span>
                        <div>
                            <span class="score-val">${(item.score > 1000 ? (item.score/1000).toFixed(1)+'k' : item.score)}</span>
                            <span class="score-lbl">Auth</span>
                        </div>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // --- MODAL ---
    function openModal(idx) {
        const i = filtered[idx];
        currentBiz = formatTitle(i.domain);
        
        let bgClass = 'bg-service';
        let cat = i.cat.toLowerCase();
        if(cat.includes('auto')) bgClass = 'bg-auto';
        if(cat.includes('tech')) bgClass = 'bg-tech';
        if(cat.includes('health')) bgClass = 'bg-health';
        if(cat.includes('retail')) bgClass = 'bg-retail';
        if(cat.includes('art')) bgClass = 'bg-art';
        if(cat.includes('estate')||cat.includes('property')) bgClass = 'bg-property';
        if(cat.includes('travel')) bgClass = 'bg-travel';
        
        const banner = document.getElementById('modalBanner');
        // Reset classes then add new ones
        banner.className = 'modal-banner ' + bgClass;
        document.getElementById('modalQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
        
        document.getElementById('mTitle').innerText = currentBiz;
        document.getElementById('mMeta').innerText = `${i.cat} ‚Ä¢ ${i.loc}`;
        document.getElementById('mDesc').innerText = i.desc;
        document.getElementById('mLoc').innerText = i.loc;
        document.getElementById('mPhone').innerText = i.wa ? '+' + i.wa : 'N/A';
        
        let link = i.url;
        if(i.domain.includes('.local') && i.wa) link = `https://wa.me/${i.wa}`;
        document.getElementById('mLink').href = link;
        
        let map = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentBiz + ' ' + i.loc)}`;
        if(i.domain.includes('greyzone')) map = "https://share.google/1O2Kl72Vige48vGsB";
        if(i.domain.includes('aolocksmith')) map = "https://share.google/WNjzMAwNlj9tC3u6F";
        
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    
    function rate(stars) {
        const formId = "1FAIpQLSefrTrv68_G_l-6-6J41szCGqg_DcTxklCcWAPJ6e-_oV0k8A";
        const url = `https://docs.google.com/forms/d/e/${formId}/viewform?usp=pp_url&entry.1871531298=${encodeURIComponent(currentBusiness)}&entry.741708013=${stars}`;
        window.open(url, '_blank');
    }

    function toggleTheme() {
        const b = document.body;
        b.setAttribute('data-theme', b.getAttribute('data-theme')==='dark'?'light':'dark');
    }

    function openJoin() {
        window.open("https://github.com/fair-collective/fair-discovery/issues/new?title=Add%20Site", '_blank');
    }

    document.getElementById('searchInput').addEventListener('input', filter);
    init();
</script>
</body>
</html>
