<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Fair Discovery: The decentralized, AI-ranked directory of authentic businesses.">
    <meta name="theme-color" content="#1a73e8">
    <title>Fair Discovery Directory</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%231a73e8'/%3E%3Ccircle cx='42' cy='42' r='24' stroke='white' stroke-width='12' fill='none'/%3E%3Cline x1='60' y1='60' x2='85' y2='85' stroke='white' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">

    <style>
        /* --- VARIABLES --- */
        :root {
            --bg: #f8f9fa; --card-bg: #ffffff; --text: #202124; --text-sub: #5f6368; 
            --border: #dadce0; --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --accent: #1a73e8; --success: #188038;
        }
        [data-theme="dark"] {
            --bg: #202124; --card-bg: #303134; --text: #e8eaed; --text-sub: #9aa0a6;
            --border: #3c4043; --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --accent: #8ab4f8; --success: #81c995;
        }

        body { font-family: 'Google Sans', 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; transition: background 0.3s; }

        /* HEADER */
        header {
            background: var(--card-bg); padding: 20px; text-align: center;
            border-bottom: 1px solid var(--border); position: relative;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        h1 { 
            font-size: 1.8rem; margin: 0; letter-spacing: -0.5px; 
            display: flex; align-items: center; gap: 10px; color: var(--text);
        }
        
        .controls { display: flex; gap: 10px; }
        .icon-btn { 
            background: transparent; border: 1px solid var(--border); color: var(--text);
            width: 36px; height: 36px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .icon-btn:hover { background: var(--bg); border-color: var(--accent); }

        /* SEARCH & FILTERS */
        .filter-bar {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; max-width: 800px; margin: 0 auto;
        }
        
        .search-wrapper {
            flex: 1; min-width: 250px; position: relative; display: flex; align-items: center;
        }
        
        .search-box {
            width: 100%; padding: 12px 45px 12px 20px; border-radius: 24px; 
            border: 1px solid var(--border); background: var(--bg); color: var(--text);
            font-size: 1rem; outline: none; transition: 0.2s;
        }
        .search-box:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(26,115,232,0.1); background: var(--card-bg); }
        
        .geo-btn { position: absolute; right: 12px; background: none; border: none; cursor: pointer; font-size: 1.2rem; opacity: 0.6; }
        .geo-btn:hover { opacity: 1; color: var(--accent); }
        .geo-btn.loading { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .loc-select {
            padding: 12px 30px 12px 20px; border-radius: 24px; border: 1px solid var(--border);
            background: var(--bg) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="%23555"><path d="M2 4l4 4 4-4"/></svg>') no-repeat right 12px center;
            color: var(--text); font-size: 0.9rem; cursor: pointer; appearance: none; min-width: 140px;
        }

        .category-scroll { 
            display: flex; gap: 8px; overflow-x: auto; padding: 15px 0 5px; 
            justify-content: center; scrollbar-width: none; mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        }
        .cat-pill {
            padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 500;
            background: var(--bg); border: 1px solid var(--border); cursor: pointer;
            color: var(--text-sub); transition: 0.2s; white-space: nowrap;
        }
        .cat-pill:hover, .cat-pill.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* GRID */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .stats-bar { display: flex; justify-content: space-between; color: var(--text-sub); font-size: 0.85rem; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }

        /* CARD */
        .card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            border: 1px solid var(--border); box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
            display: flex; flex-direction: column; position: relative;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.1); border-color: var(--accent); }
        
        .card-banner { height: 80px; background-size: cover; background-position: center; opacity: 0.9; }
        
        .card-content { padding: 0 16px 16px; flex: 1; display: flex; flex-direction: column; margin-top: -24px; }
        
        .card-brand { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; position: relative; }
        .card-logo { 
            width: 48px; height: 48px; border-radius: 10px; background: var(--card-bg); 
            display: flex; align-items: center; justify-content: center; font-size: 1.4rem; 
            border: 2px solid var(--card-bg); box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .verified-tag { 
            background: rgba(24,128,56,0.1); color: var(--success); padding: 2px 6px; 
            border-radius: 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; 
            margin-bottom: 5px;
        }

        .card-title { font-size: 1.1rem; font-weight: 700; margin: 0; color: var(--text); line-height: 1.3; }
        .card-meta { font-size: 0.8rem; color: var(--text-sub); margin: 4px 0 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .deal-badge { 
            background: #ffeff5; color: #d63384; font-size: 0.7rem; padding: 4px 8px; 
            border-radius: 4px; font-weight: 700; display: inline-block; margin-bottom: 8px;
            border: 1px solid #f8d7da;
        }

        .card-desc { font-size: 0.9rem; color: var(--text-sub); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 10px; }

        .card-footer { 
            margin-top: auto; padding-top: 12px; border-top: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem;
        }
        .score-val { font-weight: 700; color: var(--accent); font-size: 1rem; }

        /* BANNER IMAGES */
        .bg-auto { background-image: url('https://images.unsplash.com/photo-1486262715619-01b8c22973f5?auto=format&fit=crop&w=600&q=80'); }
        .bg-tech { background-image: url('https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=600&q=80'); }
        .bg-health { background-image: url('https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=600&q=80'); }
        .bg-service { background-image: url('https://images.unsplash.com/photo-1581578077058-612788a8966c?auto=format&fit=crop&w=600&q=80'); }
        .bg-retail { background-image: url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=600&q=80'); }
        .bg-art { background-image: url('https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?auto=format&fit=crop&w=600&q=80'); }
        .bg-property { background-image: url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&w=600&q=80'); }
        .bg-travel { background-image: url('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&w=600&q=80'); }

        /* MODAL */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-card { background: var(--card-bg); width: 90%; max-width: 550px; border-radius: 16px; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.3); position: relative; animation: slideUp 0.2s ease-out; display: flex; flex-direction: column; max-height: 90vh; }
        @keyframes slideUp { from{transform:translateY(10px);opacity:0} to{transform:translateY(0);opacity:1} }

        .modal-banner { height: 130px; background-size: cover; background-position: center; position: relative; display: flex; align-items: flex-end; padding: 20px; }
        .modal-banner::after { content:''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
        .modal-quote { position: relative; z-index: 2; color: white; font-style: italic; font-size: 0.9rem; width: 90%; }
        
        /* FIXED CLOSE BUTTON */
        .modal-close { 
            position: absolute; top: 15px; right: 15px; 
            background: rgba(255,255,255,0.2); color: white; 
            width: 32px; height: 32px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; backdrop-filter: blur(4px); z-index: 20; 
            font-weight: bold; font-size: 18px; border: 1px solid rgba(255,255,255,0.3);
        }
        .modal-close:hover { background: rgba(255,255,255,0.4); }

        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-header { display: flex; gap: 15px; align-items: flex-end; margin-top: -40px; margin-bottom: 15px; position: relative; z-index: 5; }
        .modal-logo { width: 70px; height: 70px; background: var(--card-bg); border-radius: 12px; font-size: 2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .info-box { background: var(--bg); padding: 10px; border-radius: 8px; border: 1px solid var(--border); font-size: 0.85rem; }
        
        .btn-primary { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: 600; cursor: pointer; display: block; text-align: center; text-decoration: none; }
        
        /* FOOTER */
        footer { margin-top: 40px; padding: 30px; text-align: center; border-top: 1px solid var(--border); color: var(--text-sub); font-size: 0.85rem; }
        #installBtn { display: none; }

        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; }
            .categories { justify-content: flex-start; padding-left: 20px; }
            .modal-card { width: 100%; height: 100%; border-radius: 0; margin: 0; max-width: none; }
            .filter-bar { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="controls">
            <button class="icon-btn" onclick="openJoin()" title="Join Network">üöÄ</button>
            <button id="installBtn" class="icon-btn" onclick="installPWA()" style="display:none" title="Install App">üì≤</button>
        </div>
        <h1>
            <svg width="36" height="36" viewBox="0 0 100 100" fill="none">
                <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#1a73e8"/><stop offset="1" stop-color="#8ab4f8"/></linearGradient></defs>
                <path d="M50 5 L90 20 V50 C90 75 50 95 50 95 C50 95 10 75 10 50 V20 Z" fill="url(#g)"/>
                <circle cx="50" cy="45" r="16" stroke="white" stroke-width="6" fill="none"/>
                <line x1="60" y1="55" x2="72" y2="67" stroke="white" stroke-width="6" stroke-linecap="round"/>
            </svg>
            Fair Discovery
        </h1>
        <div class="controls">
            <button class="icon-btn" onclick="toggleTheme()" title="Theme">üåô</button>
        </div>
    </div>

    <div class="filter-bar">
        <div class="search-wrapper">
            <input type="text" class="search-box" id="searchInput" placeholder="Search businesses...">
            <button class="geo-btn" onclick="geoFindMe()">üìç</button>
        </div>
        
        <select id="locFilter" class="loc-select" onchange="filter()">
            <option value="all">üåç Global</option>
        </select>
    </div>

    <div class="category-scroll">
        <div class="cat-pill active" onclick="setCat('all')">All</div>
        <div class="cat-pill" onclick="setCat('Auto')">Auto</div>
        <div class="cat-pill" onclick="setCat('Tech')">Tech</div>
        <div class="cat-pill" onclick="setCat('Health')">Health</div>
        <div class="cat-pill" onclick="setCat('Service')">Services</div>
        <div class="cat-pill" onclick="setCat('Retail')">Retail</div>
        <div class="cat-pill" onclick="setCat('Artists')">Artists</div>
        <div class="cat-pill" onclick="setCat('Real Estate')">Property</div>
        <div class="cat-pill" onclick="setCat('Travel')">Holiday</div>
    </div>
</header>

<div class="container">
    <div class="stats-bar">
        <span id="countLabel">Loading...</span>
        <span>Network Live</span>
    </div>
    <div id="grid" class="grid"></div>
    <div class="pagination" id="pagination"></div>
</div>

<footer style="text-align:center; padding:40px; color:var(--text-sub); border-top:1px solid var(--border); font-size:0.9rem; margin-top:40px;">
    <p>Fair Discovery &copy; 2025 ‚Ä¢ Decentralized & Open Source</p>
    <div style="margin: 20px 0;">
        <a href="https://www.buymeacoffee.com/Prinymity" target="_blank" style="background:#FFDD00; color:black; padding:8px 16px; border-radius:20px; font-weight:bold; text-decoration:none;">‚òï Support the Dev</a>
    </div>
    <p style="opacity:0.6;">Powered by Gemini ‚Ä¢ GitHub ‚Ä¢ The Fair Collective</p>
</footer>

<div id="modal" class="modal-backdrop" onclick="closeModal()">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div id="modalBanner" class="modal-banner bg-service">
            <div class="modal-close" onclick="closeModal()">‚úï</div>
            <div class="modal-quote" id="modalQuote">"Trust is the currency of the future."</div>
        </div>
        <div class="modal-body">
            <div class="modal-header">
                <div class="modal-logo" id="mLogo">üåê</div>
                <div>
                    <h2 class="modal-title" id="mTitle">Business Name</h2>
                    <div class="modal-meta" id="mMeta">Category ‚Ä¢ Loc</div>
                </div>
            </div>
            
            <p id="mDesc" style="color:var(--text); line-height:1.6; margin-bottom:25px;">Desc</p>

            <div class="info-grid">
                <div class="info-box">
                    <span class="info-label">üìç Location</span>
                    <div id="mLoc">City</div>
                </div>
                <div class="info-box">
                    <span class="info-label">üìû Contact</span>
                    <div id="mPhone">Number</div>
                </div>
            </div>

            <a id="mLink" href="#" target="_blank" class="btn-primary">Visit Website ‚Üó</a>
            
            <div style="margin-top:20px; text-align:center; border-top:1px solid var(--border); padding-top:15px;">
                <span class="info-label">Rate this Business</span>
                <div class="rating-stars">
                    <button class="star" onclick="rate(1)">‚òÖ</button>
                    <button class="star" onclick="rate(2)">‚òÖ</button>
                    <button class="star" onclick="rate(3)">‚òÖ</button>
                    <button class="star" onclick="rate(4)">‚òÖ</button>
                    <button class="star" onclick="rate(5)">‚òÖ</button>
                </div>
                <p style="text-align:center; font-size:0.8rem; color:var(--text-sub); margin-top:5px;">Rate anonymously via Google Forms</p>
            </div>
        </div>
    </div>
</div>

<div id="joinModal" class="modal-backdrop" onclick="closeModal('join')">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-body" style="text-align:center;">
            <div class="modal-close" onclick="closeModal('join')" style="background:#ddd; color:#333; top:10px; right:10px;">‚úï</div>
            <h2 style="margin-top:0;">üöÄ How to Join</h2>
            <p>1. Download the `fair-discovery` folder from GitHub.<br>2. Upload to your site root.<br>3. Submit your URL below.</p>
            <a href="https://github.com/fair-collective/fair-discovery/issues/new?title=Add%20Site" target="_blank" class="btn-primary">Submit Site</a>
        </div>
    </div>
</div>

<script>
    const FEED = 'data.json';
    let allData = [], filtered = [];
    let curCat = 'all';
    let currentBiz = "";
    
    const quotes = [
        "\"Quality means doing it right when no one is looking.\"",
        "\"Truth is the only safe ground to stand upon.\"",
        "\"Honesty is the first chapter in the book of wisdom.\"",
        "\"Fairness is a professional skill.\""
    ];

    // --- PWA INSTALLER ---
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e;
        document.getElementById('installBtn').style.display = 'inline-flex';
    });
    function installPWA() { if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; } }
    if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');

    // --- INIT ---
    async function init() {
        try {
            const res = await fetch(FEED + '?' + Date.now());
            const json = await res.json();
            processData(json.pages || []);
        } catch (e) { document.getElementById('grid').innerHTML = '<p style="text-align:center">Loading network...</p>'; }
    }

    function processData(pages) {
        const map = {};
        pages.forEach(p => {
            try {
                let d = new URL(p.url.startsWith('http')?p.url:'https://'+p.url).hostname;
                if(!map[d]) map[d] = {
                    domain: d, url: p.url, score: 0, 
                    cat: p.category || inferCat(d), 
                    desc: p.description || "Verified listing.",
                    wa: p.whatsapp, loc: p.location || "Global",
                    deal: p.deal
                };
                map[d].score += p.score;
                if(p.category) map[d].cat = p.category;
                if(p.description) map[d].desc = p.description;
            } catch(e){}
        });
        allData = Object.values(map).sort((a,b) => b.score - a.score);
        
        const locs = new Set();
        allData.forEach(i => {
            if(i.loc) {
                locs.add(i.loc);
                if(i.loc.includes(',')) locs.add(i.loc.split(',')[1].trim());
            }
        });
        const sortedLocs = [...locs].sort();
        const sel = document.getElementById('locFilter');
        sortedLocs.forEach(l => {
            if(l && l !== "Global") sel.innerHTML += `<option value="${l}">${l}</option>`;
        });

        filter();
    }

    function inferCat(d) {
        d = d.toLowerCase();
        if(d.includes('auto')||d.includes('panel')||d.includes('motor')) return 'Auto';
        if(d.includes('tech')||d.includes('app')) return 'Tech';
        if(d.includes('health')) return 'Health';
        if(d.includes('property')||d.includes('estate')) return 'Real Estate';
        if(d.includes('travel')||d.includes('bnb')) return 'Travel';
        if(d.includes('art')) return 'Artists';
        return 'Service';
    }

    function formatTitle(d) {
        if(d.includes("greyzone")) return "Grey Zone Auto Parts";
        if(d.includes("aolocksmith")) return "AO Locksmith";
        if(d.includes("autods")) return "Auto Digital Solutions";
        if(d.includes("bookkeepers")) return "Bookkeepers SA";
        if(d.includes("seritipbo")) return "Seriti PBO";
        if(d.includes("scouts")) return "Save Our Children";
        if(d.includes("jotto")) return "Jotto's Portfolio";
        if(d.includes("skyrope")) return "Sky Rope Specialist";
        if(d.includes("intpanel")) return "International Panel Shop";
        return d.split('.')[0].charAt(0).toUpperCase() + d.split('.')[0].slice(1);
    }

    function getBannerClass(cat) {
        const c = cat.toLowerCase();
        if(c.includes('auto')) return 'bg-auto';
        if(c.includes('tech')) return 'bg-tech';
        if(c.includes('health')) return 'bg-health';
        if(c.includes('art')) return 'bg-art';
        if(c.includes('retail')) return 'bg-retail';
        if(c.includes('estate') || c.includes('property')) return 'bg-property';
        if(c.includes('travel') || c.includes('holiday')) return 'bg-travel';
        return 'bg-service';
    }

    function setCat(c) {
        curCat = c;
        document.querySelectorAll('.cat-pill').forEach(e => e.classList.remove('active'));
        event.target.classList.add('active');
        filter();
    }

    function filter() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const loc = document.getElementById('locFilter').value;
        
        filtered = allData.filter(i => {
            const matchCat = curCat === 'all' || i.cat === curCat;
            let matchLoc = loc === 'all';
            if (!matchLoc && i.loc) matchLoc = i.loc.includes(loc);
            const text = (i.domain + i.desc + i.cat + i.loc + formatTitle(i.domain)).toLowerCase();
            return matchCat && matchLoc && text.includes(term);
        });
        render();
    }

    function render() {
        const grid = document.getElementById('grid'); grid.innerHTML = '';
        document.getElementById('countLabel').innerText = `Found ${filtered.length} sites`;
        
        const start = (currentPage - 1) * limit;
        const slice = filtered.slice(start, start + limit);
        
        slice.forEach((item, idx) => {
            let flag = item.domain.endsWith('.za') ? 'üáøüá¶' : 'üåê';
            let bannerClass = getBannerClass(item.cat);
            let dealBadge = item.deal ? `<div class="deal-badge">üî• ${item.deal}</div>` : '';
            
            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openModal(start + idx);
            card.innerHTML = `
                <div class="card-banner ${bannerClass}"></div>
                <div class="card-content">
                    <div class="card-brand">
                        <div class="card-logo">${flag}</div>
                        <span class="verified-tag">‚úì Verified</span>
                    </div>
                    <h3 class="card-title">${formatTitle(item.domain)}</h3>
                    <div class="card-meta">${item.domain.replace('.local','')}</div>
                    ${dealBadge}
                    <p class="card-desc">${item.desc}</p>
                    <div class="card-footer">
                        <span style="font-weight:500;">${item.cat}</span>
                        <div>
                            <span class="score-val">${(item.score > 1000 ? (item.score/1000).toFixed(1)+'k' : item.score)}</span>
                            <span class="score-lbl">Auth</span>
                        </div>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
        renderPag();
    }

    function openModal(idx) {
        const i = filtered[idx];
        currentBiz = formatTitle(i.domain);
        
        const banner = document.getElementById('modalBanner');
        banner.className = 'modal-banner ' + getBannerClass(i.cat);
        document.getElementById('modalQuote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
        
        document.getElementById('mTitle').innerText = currentBiz;
        document.getElementById('mMeta').innerText = `${i.cat} ‚Ä¢ ${i.loc}`;
        document.getElementById('mDesc').innerText = i.desc;
        document.getElementById('mLoc').innerText = i.loc;
        document.getElementById('mPhone').innerText = i.wa ? '+' + i.wa : 'N/A';
        
        let link = i.url;
        if(i.domain.includes('.local') && i.wa) link = `https://wa.me/${i.wa}`;
        document.getElementById('mLink').href = link;
        
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal(id) {
        if(id === 'join') document.getElementById('joinModal').style.display = 'none';
        else document.getElementById('modal').style.display = 'none';
    }
    
    function rate(stars) {
        const formId = "1FAIpQLSefrTrv68_G_l-6-6J41szCGqg_DcTxklCcWAPJ6e-_oV0k8A";
        const url = `https://docs.google.com/forms/d/e/${formId}/viewform?usp=pp_url&entry.1871531298=${encodeURIComponent(currentBiz)}&entry.741708013=${stars}`;
        window.open(url, '_blank');
    }

    function toggleTheme() {
        const b = document.body;
        b.setAttribute('data-theme', b.getAttribute('data-theme')==='dark'?'light':'dark');
    }

    function openJoin() { document.getElementById('joinModal').style.display = 'flex'; }
    function geoFindMe() { alert("Location search coming soon in v2!"); }
    function renderPag() {
        const el = document.getElementById('pagination'); el.innerHTML = '';
        const pages = Math.ceil(filtered.length / limit);
        if(pages <= 1) return;
        for(let i=1; i<=pages; i++) {
            el.innerHTML += `<button class="page-btn ${i===currentPage?'active':''}" onclick="currentPage=${i};render();window.scrollTo(0,0)">${i}</button>`;
        }
    }

    document.getElementById('searchInput').addEventListener('input', filter);
    init();
</script>
</body>
</html>
